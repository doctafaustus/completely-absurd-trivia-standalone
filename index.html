<!DOCTYPE html>
<html>
<head>
	<meta http-equiv="content-type" content="text/html; charset=UTF-8">
	<title>Completely Absurd Trivia</title>
	<link href='https://fonts.googleapis.com/css?family=Roboto:400,900,700' rel='stylesheet' type='text/css'>
	<link href='https://fonts.googleapis.com/css?family=Source+Sans+Pro:400,300,600,700' rel='stylesheet' type='text/css'>
	<link rel="stylesheet" type="text/css" href="normalize.css">
	<link rel="stylesheet" type="text/css" href="style.css">
	<link rel="stylesheet" type="text/css" href="hover.css">
	<link rel="stylesheet" href="flipclock.css">
	<link rel="stylesheet" type="text/css" href="jquery.mCustomScrollbar.min.css">
	<style type="text/css">
		.mCSB_dragger_bar{ width: 8px !important; background-color: #FD00AF !important; border-radius: 0 !important;}
	</style>
	<script src="socket.io.js"></script>
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>
	<script src="typed.min.js"></script>
	<script src="highcharts.js"></script>
	<script src="jquery.mCustomScrollbar.concat.min.js"></script>
	<script src="jquery.transit.min.js"></script>
	<script src="flipclock.min.js"></script>
</head>
<body>
	<div id="landing">
		<header id="landing-header">
			<img src="logo.png" id="landing-logo">
			<h1 id="landing-logo-text">Completely Absurd Trivia</h1>
			<h2 id="about">About</h2>
		</header>
		<div id="landing-main">
			<h1 id="real-time-title">Real-time Multiplayer Trivia Gameshow</h1>
			<h2 id="live">LIVE game begins in:</h2>
			<div id="clock"></div>

			<div id="hidden">
				<h2 id="enter-username">They call me...</h2>
				<form id="register-name">
					<input type="text" id="landing-username">
					<input type="submit" id="enter-game" value="Enter Game">
				</form>
			</div>
			<img id="screenshot" src="screenshot.jpg">
		</div>
	</div>
	<div id="wrapper">
		<div id="admin-bar">
			<h1>Admin</h1>
			<ul id="control-panel">
				<li><button id="get-ranks">Get Ranks</button>
			</ul>
			<h2>Questions</h2>
			<ul class="question-panel">
				<li class="question-category">Hot Pot</li>
				<li><button id="c1-q1" class="question-trigger">100</button></li>
				<li><button id="c1-q2" class="question-trigger">200</button></li>
				<li><button id="c1-q3" class="question-trigger">300</button></li>
				<li><button id="c1-q4" class="question-trigger">400</button></li>
				<li><button id="c1-q5" class="question-trigger">500</button></li>
			</ul>
			<ul class="question-panel">
				<li class="question-category">Pics of Your Mom</li>
				<li><button id="c2-q1" class="question-trigger">100</button></li>
				<li><button id="c2-q2" class="question-trigger">200</button></li>
				<li><button id="c2-q3" class="question-trigger">300</button></li>
				<li><button id="c2-q4" class="question-trigger">400</button></li>
				<li><button id="c2-q5" class="question-trigger">500</button></li>
			</ul>
			<ul class="question-panel">
				<li class="question-category">Disgusting Food</li>
				<li><button id="c3-q1" class="question-trigger">100</button></li>
				<li><button id="c3-q2" class="question-trigger">200</button></li>
				<li><button id="c3-q3" class="question-trigger">300</button></li>
				<li><button id="c3-q4" class="question-trigger">400</button></li>
				<li><button id="c3-q5" class="question-trigger">500</button></li>
			</ul>
			<ul class="question-panel">
				<li class="question-category">Memes</li>
				<li><button id="c4-q1" class="question-trigger">100</button></li>
				<li><button id="c4-q2" class="question-trigger">200</button></li>
				<li><button id="c4-q3" class="question-trigger">300</button></li>
				<li><button id="c4-q4" class="question-trigger">400</button></li>
				<li><button id="c4-q5" class="question-trigger">500</button></li>
			</ul>
			<form id="admin-form">
				<label>Admin Announcement</label><br>
				<input type="text" id="admin-input">
			</form>
			<button id="admin-hide">Hide Message</button>
			<button id="end-game">End Game</button>
		</div>
		<div id="sidebar">
			
			<div id="question-count">
				Question <span id="question-num">0</span> of 20
			</div>
			<h2 class="category-title">Leaders</h2>
			<div id="prize-section">
				<ul id="prize-board">
					<li class="prize-category">
						<div class="prize-panel">
							<div class="prize-icon">
								<img src="medal-icon.png">
							</div>
							<span class="prize-title">Most Points</span>
						</div>
						<div class="prize-leader" id="most-points-leader">
<!-- 							Devnik21 -->
						</div>
					</li>
					<li class="prize-category">
						<div class="prize-panel">
							<div class="prize-icon">
								<img src="target-icon.png">
							</div>
							<span class="prize-title">Correct %</span>
						</div>
						<div class="prize-leader" id="correct-leader">
<!-- 							AceDauntless -->
						</div>
					</li>
					<li class="prize-category">
						<div class="prize-panel">
							<div class="prize-icon">
								<img src="flame-icon.png">
							</div>
							<span class="prize-title">Best Streak</span>
						</div>
						<div class="prize-leader" id="best-streak-leader">
<!-- 							Jeriquroqui1556 -->
						</div>
					</li>
					<li class="prize-category">
						<div class="prize-panel">
							<div class="prize-icon">
								<img src="goat-icon.png" id="goat">
							</div>
							<span class="prize-title">Goat of the Game</span>
						</div>
						<div class="prize-leader" id="goat-leader">
<!-- 							Amy445 -->
						</div>
					</li>
				</ul>
			</div>

			<h2 class="category-title">Leaderboard</h2>
			<div id="leaderboard">
<!-- 				<table id="leaderboard-list">
					<tr>
						<td class="leaderboard-rank">1.</td>
						<td class="leaderboard-score">2000</td>
						<td class="leaderboard-user">Devnik21</td>
					</tr>
					<tr>
						<td class="leaderboard-rank">2.</td>
						<td class="leaderboard-score">1900</td>
						<td class="leaderboard-user">AceDauntless</td>
					</tr>
					<tr>
						<td class="leaderboard-rank">3.</td>
						<td class="leaderboard-score">1800</td>
						<td class="leaderboard-user">Jeriquroqui1556</td>
					</tr>
					<tr>
						<td class="leaderboard-rank">4.</td>
						<td class="leaderboard-score">1700</td>
						<td class="leaderboard-user">Amy445</td>
					</tr>
					<tr>
						<td class="leaderboard-rank">5.</td>
						<td class="leaderboard-score">1500</td>
						<td class="leaderboard-user">JJfine</td>
					</tr>
					<tr>
						<td class="leaderboard-rank">6.</td>
						<td class="leaderboard-score">1500</td>
						<td class="leaderboard-user">Stupidpeas</td>
					</tr>
					<tr>
						<td class="leaderboard-rank">7.</td>
						<td class="leaderboard-score">1100</td>
						<td class="leaderboard-user">YoYomah233245</td>
					</tr>
					<tr>
						<td class="leaderboard-rank">8.</td>
						<td class="leaderboard-score">900</td>
						<td class="leaderboard-user">AweraFF4</td>
					</tr>
					<tr>
						<td class="leaderboard-rank">9.</td>
						<td class="leaderboard-score">750</td>
						<td class="leaderboard-user">ChillNation</td>
					</tr>
					<tr>
						<td class="leaderboard-rank">10.</td>
						<td class="leaderboard-score">600</td>
						<td class="leaderboard-user">Idiocrazy</td>
					</tr>
				</table> -->
			</div>

			<h2 class="category-title">Categories</h2>
			<div class="category-section">
				<div class="category-icon">
					<img src="pot-icon.png">
				</div>
				<a class="category" href="#">Hot Pot</a>
				<ul class="category-list">
					<li class="c1-q1">100</li>
					<li class="c1-q2">200</li>
					<li class="c1-q3">300</li>
					<li class="c1-q4">400</li>
					<li class="c1-q5">500</li>
				</ul>
			</div>
			<div class="category-section">
				<div class="category-icon">
					<img src="woman-icon.png">
				</div>
				<a class="category" href="#">Pics of Your Mom</a>
				<ul class="category-list">
					<li class="c2-q1">100</li>
					<li class="c2-q2">200</li>
					<li class="c2-q3">300</li>
					<li class="c2-q4">400</li>
					<li class="c2-q5">500</li>
				</ul>
			</div>
			<div class="category-section">
				<div class="category-icon">
					<img src="fishhead-icon.png">
				</div>
				<a class="category" href="#">Disgusting Food</a>
				<ul class="category-list">
					<li class="c3-q1">100</li>
					<li class="c3-q2">200</li>
					<li class="c3-q3">300</li>
					<li class="c3-q4">400</li>
					<li class="c3-q5">500</li>
				</ul>
			</div>
			<div class="category-section">
				<div class="category-icon">
					<img src="penguin-icon.png">
				</div>
				<a class="category" href="#">Memes</a>
				<ul class="category-list">
					<li class="c4-q1">100</li>
					<li class="c4-q2">200</li>
					<li class="c4-q3">300</li>
					<li class="c4-q4">400</li>
					<li class="c4-q5">500</li>
				</ul>
			</div>

		</div>
		<div id="main">
			<header>
				<img src="logo.png" id="logo">
				<h1 id="logo-text">Completely Absurd Trivia</h1>
				<div id="header-right">
					<img id="avatar" src="avatar.jpg">
					<span id="username"></span>
				</div>
			</header>
			<div id="console">
					<div id="game-results-title">
						Final Results
					</div>
					<iframe id="video" src="http://player.twitch.tv/?channel=clowd150" frameborder="0" scrolling="no" height="378" width="626"></iframe>
				<div class="question-container-desktop">
					<div class="question-image-container">

						<img id="question-image" src="http://i.imgur.com/gfElT1J.png">
					</div>
					<div class="question">
						Welcome to Completely Absurd Trivia
					</div>
					<div id="generating">
						Generating Scores...<br>
						<img src="loading.gif">
					</div>
					<div class="progress-container">
						<div class="outer-progress">
							<div class="progress-bar" style="width: 100%; margin-left: 0px;">&nbsp;</div>
						</div>
					</div>
					<div class="correct-indicator">
						<span id="correct-amount"></span>
						<span id="bonus-amount"></span>
					</div>
				</div>
			</div>
			<div id="left-col">
				<div class="answers">
					<div id="answers-inner">
						<div class="a-c">
							<button class="answer hvr-hollow" id="A">&nbsp;</button>
							<button class="answer hvr-hollow" id="C">&nbsp;</button>
						</div>
						<div class="b-d">
							<button class="answer hvr-hollow" id="B">&nbsp;</button>
							<button class="answer hvr-hollow" id="D">&nbsp;</button>
						</div>
					</div>
				</div>
				<div id="my-scores">
					<div class="score-row-left">
						<div id="my-score" class="score-large score-left">0</div>
						<div class="score-small score-left">Score</div>
					</div>
					<div class="score-row-right">
						<div id="my-rank" class="score-large">0</div>
						<div class="score-small">Rank</div>
					</div>
					<div class="score-row-left score-second-row">
						<div id="my-streak" class="score-large score-left">0</div>
						<div class="score-small score-left">Streak</div>
					</div>
					<div class="score-row-right score-second-row">
						<div id="my-accuracy" class="score-large">100%</div>
						<div class="score-small">Accuracy</div>
					</div>
				</div>
				<div id="chart1"></div>
			</div>
			<div id="right-col">
				<div id="chart3-container">
					<a id="show-chat" href="#">SHOW CHAT</a>
					<div id="chart3"></div>
				</div>
				<div id="chat">
					<div id="admin-message">
						<div id="admin-message-inner">
							<img src="admin-chat-icon.png">
							<span id="admin-message-text"></span>
						</div>
					</div>
					<div id="new-messages">
						More comments below
					</div>
					<ul id="chat-messages">
<!-- 						<li class="message-row">
							<span class="chat-user">Elite Dude</span><span class="message">The*</span>
						</li>
						<li class="message-row">
							<span class="chat-user">gilion games</span><span class="message"></span>
						</li>
						<li class="message-row">
							<span class="chat-user">Darian Garcia</span><span class="message">(666)420-6969 is his number</span>
						</li>
						<li class="message-row">
							<span class="chat-user">aj stone</span><span class="message">DAB</span>
						</li>
						<li class="message-row">
							<span class="chat-user">Gold Playz</span><span class="message">Watch you lose lol</span>
						</li>
						<li class="message-row">
							<span class="chat-user">DJ Unreal</span><span class="message">The culling</span>
						</li>
						<li class="message-row">
							<span class="chat-user">Douglas Bodxy</span><span class="message">add me lil deenine132 on ps4</span>
						</li>
						<li class="message-row">
							<span class="chat-user">Mr. K</span><span class="message">Behind you Noah</span>
						</li>
						<li class="message-row">
							<img class="user-icon" src="avatars/aaron-perez.png"><span class="chat-user">Aaron Perez</span><span class="message">a rock and the poison</span>
						</li>
						<li class="message-row">
							<img class="user-icon" src="avatars/B18aturbo.png"><span class="chat-user">B18aturbo</span><span class="message">DAB</span>
						</li>
						<li class="message-row">
							<img class="user-icon" src="avatars/gavyn-wesner.png"><span class="chat-user">Gavyn Wesner</span><span class="message">how do you know</span>
						</li>
						<li class="message-row">
							<img class="user-icon" src="avatars/gold-playz.png"><span class="chat-user">Gold Playz</span><span class="message">Watch you lose lol</span>
						</li>
						<li class="message-row">
							<img class="user-icon" src="avatars/dj-unreal.png"><span class="chat-user">DJ Unreal</span><span class="message">The culling</span>
						</li>
						<li class="message-row">
							<img class="user-icon" src="avatars/douglas-bodxy.png"><span class="chat-user">Douglas Bodxy</span><span class="message">add me lil deenine132 on ps4</span>
						</li>
						<li class="message-row">
							<img class="user-icon" src="avatars/mr-k.png"><span class="chat-user">Mr. K</span><span class="message">Behind you Noah</span>
						</li>
						<li class="message-row">
							<img class="user-icon" src="avatars/aaron-perez.png"><span class="chat-user">Aaron Perez</span><span class="message">a rock and the poison</span>
						</li>
						<li class="message-row">
							<img class="user-icon" src="avatars/B18aturbo.png"><span class="chat-user">B18aturbo</span><span class="message">DAB</span>
						</li>
						<li class="message-row">
							<img class="user-icon" src="avatars/gavyn-wesner.png"><span class="chat-user">Gavyn Wesner</span><span class="message">how do you know</span>
						</li> -->
					</ul>
					<div id="chat-control">
						<form id="chat-form">
							<img class="user-icon" id="my-icon" src="avatar.jpg">
							<input type="text" id="message-input" placeholder="Say something...">
						</form>
					</div>
					<div id="chat-bottom">
						<a href="#" id="hide-chat">HIDE CHAT</a>
					</div>
				</div>

				<div id="chart2"></div>
			</div>


			<!-- Results Section -->
			<div id="results-section">
				<div id="badges-received">
					<h2>Badges Awarded</h2>
					<ul id="badges-received-list">
					</ul>
				</div>

				<div id="stats">
					<h2>Player Statistics</h2>
					<table>
						<tr>
							<th class="rank-row">Rank</th>
							<th class="player-row">Player</th>
							<th class="score-row">Score</th>
							<th class="streak-row">Best Streak</th>
							<th class="accuracy-row">Accuracy</th>
							<th class="badges-row">Badges Awarded</th>
						</tr>
					</table>
				</div>
			</div>
		</div>
	</div>
	<script>
		$(document).ready(function() {
			// Global variables
			var socket;
			var endGame = true;
			var timeStart = 0;
			var timeEnd = 0;
			var answerTime = 0;
			var fastAnswer = false;
			var touchedScroll = false;
			var username;

	        // Sounds
		    var goatSound = document.createElement('audio');
		    goatSound.setAttribute('src', 'sounds/goat.mp3');

		    var rightAnswer = document.createElement('audio');
		    rightAnswer.setAttribute('src', 'sounds/music_marimba_chord.wav');

		    var wrongAnswer = document.createElement('audio');
		    wrongAnswer.setAttribute('src', 'sounds/wrong.mp3');

		    var selectAnswer = document.createElement('audio');
		    selectAnswer.setAttribute('src', 'sounds/pop_drip.mp3');

			var questionPresent = document.createElement('audio');
		    questionPresent.setAttribute('src', 'sounds/question_louder.mp3');

		    var boot = document.createElement('audio');
		    boot.setAttribute('src', 'sounds/boot.wav');
		    

			// Initially disable answer buttons
			$(".answer").prop("disabled", true);

			// Register answer and track answer speed
			var submittedAnswer = null;
			$(".answer").click(function() {
				selectAnswer.play();
				timeEnd = new Date().getTime();
				answerTime = timeEnd - timeStart;
				fastAnswer = answerTime < 3000 ? true : false;
				console.log(answerTime);
				console.log(fastAnswer);
				submittedAnswer = $(this).attr("id").toLowerCase();
				console.log("submittedAnswer: " + submittedAnswer);
			});



			// Category dropdown event handler
			$(".category-section").click(function(e) {
				e.preventDefault();
				$(this).find(".category-list").slideToggle();
			});


			function coolType(string) {
				$(".question").data('typed', null).typed({
					strings: [string],
					contentType: "text",
					typeSpeed: -35,
					showCursor: false,
					callback: function() {
						// IMPORTANT - don't run the timer in the callback function (if the window is inactive there will be a delay before it is run)
					}
				});	

				// Wait 3 seconds setting off rolling timer bar
				setTimeout(function() {
					timerBar();
				}, 2000);
			}

			function timerBar() {
				timeStart = new Date().getTime();
				$(".progress-bar").transition({ width: 0 }, 5000, 'linear', function() {
						$(".answer").prop("disabled", true);
						socket.emit("answerGuessed", submittedAnswer, fastAnswer);
						$("#generating").fadeIn();
						console.log("done!");
				});

				//$(".outer-progress").attr('style', 'height: 5px;');

				// $(".outer-progress").animate(
				// 	{
				// 		width: "0%"
				// 	}, 
				// 	{
				// 		duration: 3000,
				// 		specialEasing: {
				// 			width: "linear"
				// 		},
				// 		complete: function() {
				// 			$(".answer").prop("disabled", true);

				// 			socket.emit("answerGuessed", submittedAnswer);

				// 			$("#generating").fadeIn();
				// 		}
				// 	}
				// );

				// Work in progress...
				// var div = $(".outer-progress");
				// var a = 100;
				// var delay = (2000 / 30);
				// var now, before = new Date();

				// console.time("start");
				// var interval = setInterval(function() {
				//     now = new Date();
				//     var elapsedTime = (now.getTime() - before.getTime());
				//     if(elapsedTime > delay)
				//         //Recover the motion lost while inactive.
				//         a -= Math.floor(elapsedTime/delay);
				//     else
				//         a--;
				//     div.css("width", a + "%");
				//     before = new Date();
				//     if (a <= 0) {
				//     	console.timeEnd("start");
				//     	console.log("tests");
				//     	clearInterval(interval);
				//     }
				// }, delay);

			}

			function formatAnswerHeight() {
				$(".answer").attr('style', 'height: inherit');
				var maxHeight = Math.max.apply(null, $(".answer").map(function() {return $(this).height();}).get());

				var answers = $.map($(".answer"), function(val, i) {
					if ($(val).height() !== maxHeight) {
						return val;
					}
				});

				$(".answer").attr('style', 'height: ' + (maxHeight + 20) + 'px;');
			}
			formatAnswerHeight();




			// Answer selection
			$(document).on('click', '.answer', function(e) {
				e.preventDefault();
				$(this).addClass('selected');
				$(".answer").prop("disabled", true);
			});


		    // Custom Scrollbar
		    var scrollPosition = ""; // Keep track of scroll position
		    $("#chat-messages").mCustomScrollbar({
		    	theme: "dark",
		    	scrollInertia: 0,
		    	advanced:{ updateOnContentResize: true, updateOnSelectorChange: ".message-row" },
			    callbacks: {
			        whileScrolling:function() {
			        	scrollPosition = this.mcs.topPct;
			        }
			    }
			});

			// Track if user has touched scrollbar
			$(".mCSB_draggerContainer").click(function() {
				touchedScroll = true;
			});


			// Create custom event to keep track of messages
			$(document).on("checkChatPosition", function() {
				// Message cleanup
				if ($(".message-row").length > 50) {
					console.log("greater than 50");
					$(".message-row").first().remove();
				}

				console.info(scrollPosition);
				console.log($(".message-row").length);
				if (scrollPosition <= 90 && $(".message-row").length > 14) {
					$("#new-messages").fadeIn(200);
				} else {
					$("#chat-messages").mCustomScrollbar("scrollTo","bottom");
				}

			});


			$("#new-messages").click(function() {
				$(this).fadeOut(200);
				$("#chat-messages").mCustomScrollbar("scrollTo","bottom");
			});


		    // Keep scrollbar at bottom
		    setTimeout(function() { // FireFox needs a small delay
				$("#chat-messages").mCustomScrollbar("scrollTo","bottom");
		    }, 600);

			// setTimeout(function() {
			// 	var message = '<li class="message-row"><img class="user-icon" src="avatars/new-wesner.png"><span class="chat-user">New Wesner</span><span class="message">This is a new messages, jsut so you know</span></li>';$("#mCSB_1_container").append(message);
			// 	if (scrollPosition > 90 || !touchedScroll) { // If user has scrolled up then don't move the scrollbar for them
			// 		$("#chat-messages").mCustomScrollbar("scrollTo","bottom");
			// 	}
			// }, 1500);
			// setTimeout(function() {
			// 	var message = '<li class="message-row"><img class="user-icon" src="avatars/new-wesner.png"><span class="chat-user">New Wesner</span><span class="message">This is a new messages, jsut so you know</span></li>';$("#mCSB_1_container").append(message);
			// 	if (scrollPosition > 90 || !touchedScroll) {
			// 		$("#chat-messages").mCustomScrollbar("scrollTo","bottom");
			// 	}
			// }, 4500);

			


			// Charts
		    $('#chart1').highcharts({
		        chart: {
		            type: 'column'
		        },
		        plotOptions: {
		            column: {
		                colorByPoint: true
		            }
		        },
		        colors: [
		            '#1797FF',
		            '#1797FF',
		            '#FD00AF',
		           	'#1797FF',
		            '#1797FF'
		        ],
		        credits: {
		        	enabled: false
		        },
		        title: {
		            text: 'Question Results'
		        },
		        xAxis: {
		            categories: [
		                '',
		                '',
		                '',
		                '',
		                ""
		            ]
		        },
		        yAxis: {
		            title: {
		                text: 'Question 0/20'
		            }
		        },
		        series: [{
		        	showInLegend: false,
		            name: 'Players',
		            data: [0, 0, 0, 0, 0]
		        }],
		    });


		    function generateChart1(data) {
			    $('#chart1').highcharts({
			        chart: {
			            type: 'column'
			        },
			        plotOptions: {
			            column: {
			                colorByPoint: true
			            }
			        },
			        colors: data.colors,
			        credits: {
			        	enabled: false
			        },
			        title: {
			            text: data.title
			        },
			        xAxis: {
			            categories: data.categories
			        },
			        yAxis: {
			            title: {
			                text: "Question " + data.questionsAsked + "/20"
			            }
			        },
			        series: [{
			        	showInLegend: false,
			            name: 'Players',
			            data: data.answersByPlayers
			        }],
			    });
		    }


	        $('#chart2').highcharts({
		        chart: {
		            type: 'bar'
		        },
		        plotOptions: {
		            column: {
		                colorByPoint: true
		            }
		        },
		        colors: [
		            '#FD00AF',
		            ],
		        credits: {
		        	enabled: false
		        },
		        title: {
		            text: 'Player Scores'
		        },
		        xAxis: {
		            categories: [
		            	"50000+",
		            	"4000 - 4999",
		            	"3000 - 3999",
		            	"2000 - 2999",
		            	"1000 - 1999",
		            	"500 - 999",
		            	"0 - 499"
		            ]
		        },
		        yAxis: {
		            title: {
		                text: 'Players'
		            }
		        },
		        series: [{
		        	showInLegend: false,
		            name: 'Players',
		            data: [0, 0, 0, 0, 0, 0, 0]
		        }],
	        });


	        function generateChart2 (levelsArray) {
		        $('#chart2').highcharts({
			        chart: {
			            type: 'bar'
			        },
			        plotOptions: {
			            column: {
			                colorByPoint: true
			            }
			        },
			        colors: [
			            '#FD00AF',
			            ],
			        credits: {
			        	enabled: false
			        },
			        title: {
			            text: 'Player Scores'
			        },
			        xAxis: {
			            categories: [
			            	"50000+",
			            	"4000 - 4999",
			            	"3000 - 3999",
			            	"2000 - 2999",
			            	"1000 - 1999",
			            	"500 - 999",
			            	"0 - 499"
			            ]
			        },
			        yAxis: {
			            title: {
			                text: 'Players'
			            }
			        },
			        series: [{
			        	showInLegend: false,
			            name: 'Players',
			            data: levelsArray
			        }],
		        });
	        }


		    $('#chart3').highcharts({
		        credits: {
		        		enabled: false
		        },
		        chart: {
		            plotBackgroundColor: null,
		            plotBorderWidth: null,
		            plotShadow: false,
		            type: 'pie'
		        },
		        colors: [
		        	'#1797FF',
		            '#FD00AF'
		        ],
		        title: {
		            text: 'Accuracy'
		        },
		        tooltip: {
		            pointFormat: '{series.name}: <b>{point.percentage:.1f}%</b>'
		        },
		        plotOptions: {
		            pie: {
		                dataLabels: {
		                    enabled: true,
		                    format: '<b>{point.name}</b>: {point.percentage:.1f} %',
		                    style: {
		                        color: (Highcharts.theme && Highcharts.theme.contrastTextColor) || 'black'
		                    }
		                }
		            }
		        },
		        series: [{
		            name: 'Questions',
		            colorByPoint: true,
		            data: [{
		                name: 'Correct',
		                y: 100
		            }, {
		                name: 'Incorrect',
		                y: 0
		            }]
		        }]
		    });

		    function generateChart3(accuracy) {
			    $('#chart3').highcharts({
			        credits: {
			        		enabled: false
			        },
			        chart: {
			            plotBackgroundColor: null,
			            plotBorderWidth: null,
			            plotShadow: false,
			            type: 'pie'
			        },
			        colors: [
			        	'#1797FF',
			            '#FD00AF'
			        ],
			        title: {
			            text: 'Accuracy'
			        },
			        tooltip: {
			            pointFormat: '{series.name}: <b>{point.percentage:.1f}%</b>'
			        },
			        plotOptions: {
			            pie: {
			                dataLabels: {
			                    enabled: true,
			                    format: '<b>{point.name}</b>: {point.percentage:.1f} %',
			                    style: {
			                        color: (Highcharts.theme && Highcharts.theme.contrastTextColor) || 'black'
			                    }
			                }
			            }
			        },
			        series: [{
			            name: 'Questions',
			            colorByPoint: true,
			            data: [{
			                name: 'Correct',
			                y: accuracy
			            }, {
			                name: 'Incorrect',
			                y: 100 - accuracy
			            }]
			        }]
			    });
		    }


	        // Hide chat - show piechart
	        $("#hide-chat").click(function(e) {
	        	e.preventDefault();
	        	$("#chat").hide();
	        	$("#chart3-container").show();
	        });

	        // Show chat - hide piechart
	        $("#show-chat").click(function(e) {
	        	e.preventDefault();
	        	$("#chart3-container").hide();
	        	$("#chat").show();
	        });

	        // Goat easter egg
		    $('#goat').click(function() {
		        goatSound.play();
		    });
		    
		    // Badge hover overs
		    $(document).on('mouseenter', '.badge', function() {
		    	var badgeDescription = $(this).prev().text();
			    $(this).parent().parent().find(".badge-hover-over").show().text(badgeDescription);
			}).on('mouseleave', '.badge', function() {
			    $(this).parent().parent().find(".badge-hover-over").hide();
			});



			function connect(username) {
				// Intialize Socket.io
				socket = io('http://localhost:3000');

				// Initialize
				socket.on('initialize', function (data) {
					$('#username').text(username);
					socket.emit('register', username);
				});


				socket.on('userNameTaken', function() {
					console.log('user name has been taken');
					socket.disconnect();
					alert('Username currently in user. Please try another!');
				});

				socket.on('registrationComplete', function() {
					$('#my-icon, #avatar').attr('src', 'http://api.adorable.io/avatar/70/' + username);
					$('body').addClass('new-height');
					$('#landing').slideUp(function() {
						$('#wrapper').slideDown();
						boot.play();
					});

				});

				socket.on('showAdmin', function() {
					$('#admin-bar').show();
					$("#wrapper").addClass("admin-wrapper");
				});

				// Get ranks
				$("#get-ranks").click(function() {
					socket.emit('getRanks');
				});
				socket.on('playersRanked', function (data) {
					// Most Points
					$("#most-points-leader").hide().html(data.playerData.highestScoreData.highestScorePlayer + " (" + data.playerData.highestScoreData.highestScoreNumber + ")").fadeIn(1000);
					// Correct %
					$("#correct-leader").hide().html(data.playerData.highestAccuracyData.highestAccuracyPlayer + " (" + data.playerData.highestAccuracyData.highestAccuracyNumber + "%)").fadeIn(1000);
					// Best Streak
					$("#best-streak-leader").hide().html(data.playerData.highestStreakData.highestStreakPlayer + " (" + data.playerData.highestStreakData.highestStreakNumber + ")").fadeIn(1000);
					// Goat of the Game
					$("#goat-leader").hide().html(data.playerData.goat).fadeIn(1000);


					// Populate leaderboard
					$("#leaderboard").hide().html(data.playerData.leaderboard).fadeIn(1000);

					// Get individual scores
					socket.emit('getIndividualScores');

					// Basically this checks to see if the playersRank event was triggered manually or automatically (automatic triggers should should specific data)
					if (data.extraData) { 
						// Hide Generating Scores...
						$("#generating").hide();

						// Generate chart 1
						generateChart1(data.extraData.chart1);
						// Generate chart 2
						generateChart2(data.playerData.chart2);

						console.log(data);
					}
				});

				// Show individual scores
				socket.on("showIndividualScores", function(individualData) {
					console.log(individualData);

					// Popular main score panel
					$("#my-score").text(individualData.score);
					$("#my-rank").text(individualData.rank + "/" + individualData.totalPlayers);
					$("#my-streak").text(individualData.streak);
					$("#my-accuracy").text(individualData.accuracy + "%");

					// Color category list based on last answer
					if (individualData.currentQuestionCorrect) {
						$("." + individualData.currentQuestionID).addClass("correct");
					} else {
						$("." + individualData.currentQuestionID).addClass("incorrect");
					}
					
					// Save reference to correct answer
					var correctAnswer = individualData.currentQuestionAnswer.toUpperCase();

					// Show correct or incorrect messaging
					if (individualData.currentQuestionCorrect) {
						rightAnswer.play();
						// Fast Answer
						if (individualData.currentQuestionCorrect && fastAnswer) {
							$("#bonus-amount").html("<br>+50 Fast Answer");
						}
						$("#correct-amount").text("+" + individualData.currentQuestionPointValue);

						$(".correct-indicator").slideDown(500); // (Show)
						$("#" + correctAnswer).addClass("blink");
						$("#" + correctAnswer).addClass("correct-answer");
					} else {
						wrongAnswer.play();
						$("#" + correctAnswer).addClass("incorrect-answer");
					}

					// Generate chart 3
					generateChart3(Number(individualData.accuracy));
					console.log(Number(individualData.accuracy));
				});

				// Question control panel
				$(".question-trigger").click(function() {
					var questionID = $(this).attr('id');
					socket.emit('questionTriggered', questionID);
				});

				socket.on('questionPresented', function(questionData) {
					questionPresent.play();

					// Reset time to answer values
					timeStart = 0;
					timeEnd = 0;
					answerTime = 0;
					fastAnswer = false;

					// Hide correct bar
					$(".correct-indicator").hide(); // (Hide)
					$("#bonus-amount").html("");

					// Remove old classes on answers
					$(".answer").removeClass("blink");
					$(".answer").removeClass("correct-answer");
					$(".answer").removeClass("incorrect-answer");

					// Reset timer bar
					$(".progress-bar").attr("style", "width: 100%;");

					// Increment question counter at top of page
					$("#question-num").text(questionData.questionNum + 1);

					// Reset submitted answer
					submittedAnswer = null;

					// Show question with answers
					coolType(questionData.question.q);
					$("#A").text(questionData.question.a);
					$("#B").text(questionData.question.b);
					$("#C").text(questionData.question.c);
					$("#D").text(questionData.question.d);
					formatAnswerHeight();

					// Show picture if the question is an image type otherwise show 1x1 transparent pixel placeholder
					if (questionData.question.type === "image") {
						console.log(questionData.question.href);
						$("#question-image").attr("src", questionData.question.href);
						$(".question").addClass("with-picture");
					} else {
						$("#question-image").attr("src", "http://i.imgur.com/gfElT1J.png");
						$(".question").removeClass("with-picture");
					}

					// Reset button styles
					$(".answer").prop("disabled", false).removeClass("selected");
				});


				// Chat send
				var lastMessageSent;
				var sentAny = false;
				$("#chat-form").submit(function(e) {
					var currentMessageTime = new Date().getTime();

					//console.log(currentMessageTime - lastMessageSent);

					// Prevent message from being sent if last message was less than 3 seconds ago
					if (currentMessageTime - lastMessageSent < 3000) {
						alert("Please wait a bit before sending multiple messages");
						return false;
					}

					e.preventDefault();
					var message = $("#message-input").val();
					socket.emit("send-message", message);
					$("#message-input").val("");

					lastMessageSent = currentMessageTime;
				});

				// Chat receive
				socket.on("incoming-message", function(message) {
					var message = '<li class="message-row"><img class="user-icon" src="http://api.adorable.io/avatar/45/' + username + '"><span class="chat-user">' + username + '</span><span class="message">' + message + '</span></li>';$("#mCSB_1_container").append(message);

					// Trigger 
					$(document).trigger("checkChatPosition");
				});

				// Move video based on window size

				var chat = $("#chat");
				function resize() {
					var width = $(window).width();
					if (width < 1600 && chat.attr("class") !== "chat-mobile") {
						// Move chat
						$("#chart1").before(chat);
						chat.addClass("chat-mobile");
						chat.after($("#chart3-container"));

					} else if (width >= 1600) {
						chat.removeClass("chat-mobile");
						$("#chart2").before(chat);
						chat.before($("#chart3-container"));
					}
				}

				resize();
				$(window).resize(function() {
					resize();
	    		});


				// End Game
				// Hide everything except the video
				$("#end-game").click(function() {
					socket.emit("end-game");
				});
				socket.on("game-over", function(resultTable) {
					console.log("GAME OVER");
					$("#results-section").show();
					$("#left-col, #right-col, .question-container-desktop").fadeToggle(function() {
							$("#console").attr("style", "text-align: center; height: 420px; margin-bottom: 10px;");
							$("#video").attr("style", "float: none;");
							$("#game-results-title").slideDown();
					});
					$("#stats table tbody").append(resultTable);
					socket.emit("get-individual-badges");
				});
				socket.on("badges-returned", function(badges) {
					console.log(badges);

					// Compile badges and insert into DOM
					if (badges.length === 0) {
						$("#badges-received").hide();
					} else {
						var badgeHTML = "";
						for (var i = 0; i < badges.length; i++) {
							badgeHTML += "<li><div class='badge-title'>" + badges[i].title + "</div><img src='" + badges[i].href + "'><div class='badge-description'>" +badges[i].description + "</div></li>";
						}
						$("#badges-received-list").html(badgeHTML);
					}
				});

				// Admin annoucement
				$("#admin-form").submit(function(e) {
					e.preventDefault();
					var message = $("#admin-input").val();
					$("#admin-input").val("");
					socket.emit("admin-send-message", message);
				});
				socket.on("admin-incoming-message", function(message) {
					$("#admin-message-text").text("Admin: " + message);
					$("#admin-message").show();
				});
				$("#admin-hide").click(function() {
					socket.emit("admin-hide-triggered");
				});
				socket.on("admin-hide", function() {
					$("#admin-message").hide();
				});
			}
		    
			var clock = $('#clock').FlipClock({
				countdown: true,
			});
			clock.setTime(10);
			//clock.start();

			function detectIE() {
			    var ua = window.navigator.userAgent;

			    var msie = ua.indexOf('MSIE ');
			    if (msie > 0) {
			        // IE 10 or older => return version number
			        return parseInt(ua.substring(msie + 5, ua.indexOf('.', msie)), 10);
			    }

			    var trident = ua.indexOf('Trident/');
			    if (trident > 0) {
			        // IE 11 => return version number
			        var rv = ua.indexOf('rv:');
			        return parseInt(ua.substring(rv + 3, ua.indexOf('.', rv)), 10);
			    }

			    var edge = ua.indexOf('Edge/');
			    if (edge > 0) {
			       // Edge (IE 12+) => return version number
			       return parseInt(ua.substring(edge + 5, ua.indexOf('.', edge)), 10);
			    }

			    // other browser
			    return false;
			}


			$('#register-name').submit(function(e) {
				e.preventDefault();
				if (detectIE()) {
					alert('Browser not supported. Please use Google Chrome!');
				} else if ($('#landing-username').val() == '') {
					alert('Please enter a username');
				} else if ($('#landing-username').val().length >= 16) {
					alert('Username too long! (15 characters max)');
				} else {
					username = $('#landing-username').val();
					connect(username);
				}
			});


		});
	</script>
	<script src="flipclock.min.js"></script>
</body>
</html>